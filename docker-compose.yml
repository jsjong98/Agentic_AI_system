services:
  # =============================================================================
  # ğŸ¤– Agentic AI System - ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (ëª¨ë“  ì—ì´ì „íŠ¸ í†µí•©)
  # =============================================================================
  agentic-backend:
    build: 
      context: ./app
      dockerfile: Dockerfile
    container_name: agentic-backend
    restart: unless-stopped
    ports:
      - "5001:5001"  # Structura Agent
      - "5002:5002"  # Cognita Agent  
      - "5003:5003"  # Chronos Agent
      - "5004:5004"  # Sentio Agent
      - "5005:5005"  # Agora Agent
      - "5006:5006"  # Supervisor Agent (ë©”ì¸ API)
      - "5007:5007"  # Integration Agent
    volumes:
      - agentic_models:/app/models
      - agentic_uploads:/app/uploads
      - agentic_cache:/app/cache
      - agentic_results:/app/results
      - agentic_logs:/app/logs
      - agentic_temp:/app/temp
      - agentic_data:/app/data
      # ê° ì—ì´ì „íŠ¸ë³„ ì „ìš© ë³¼ë¥¨
      - structura_models:/app/Structura/models
      - cognita_cache:/app/Cognita/cache
      - chronos_models:/app/Chronos/models
      - sentio_cache:/app/Sentio/cache
      - agora_data:/app/Agora/data
      - supervisor_logs:/app/Supervisor/logs
      - integration_results:/app/Integration/results
    environment:
      # GPU ì„¤ì •
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      # Flask í™˜ê²½ ì„¤ì •
      - FLASK_ENV=production
      - PYTHONUNBUFFERED=1
      # ì—ì´ì „íŠ¸ í¬íŠ¸ ì„¤ì •
      - STRUCTURA_PORT=5001
      - COGNITA_PORT=5002
      - CHRONOS_PORT=5003
      - SENTIO_PORT=5004
      - AGORA_PORT=5005
      - SUPERVISOR_PORT=5006
      - INTEGRATION_PORT=5007
      # Neo4j ì„¤ì • (Cognitaìš©)
      - NEO4J_URI=bolt://54.162.43.24:7687
      - NEO4J_USERNAME=neo4j
      - NEO4J_PASSWORD=resident-success-moss
      # OpenAI API ì„¤ì • (Sentio, Agora, Supervisor, Integrationìš©)
      # - OPENAI_API_KEY=your-api-key-here  # ì‹¤ì œ ì‚¬ìš© ì‹œ ì„¤ì • í•„ìš”
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸŒ React Dashboard - í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤
  # =============================================================================
  agentic-dashboard:
    build: 
      context: ./Dashboard
      dockerfile: Dockerfile
    container_name: agentic-dashboard
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      agentic-backend:
        condition: service_healthy
    environment:
      # React í™˜ê²½ ë³€ìˆ˜ (ë¹Œë“œ ì‹œì ì— ì„¤ì •ë¨)
      - REACT_APP_API_BASE_URL=http://localhost:5006
      - REACT_APP_SUPERVISOR_URL=http://localhost:5006
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - agentic-network

# =============================================================================
# ğŸ“¦ ë³¼ë¥¨ ì„¤ì • - ë°ì´í„° ì˜ì†ì„±
# =============================================================================
volumes:
  # ê³µí†µ ë³¼ë¥¨
  agentic_models:
    driver: local
  agentic_uploads:
    driver: local
  agentic_cache:
    driver: local
  agentic_results:
    driver: local
  agentic_logs:
    driver: local
  agentic_temp:
    driver: local
  agentic_data:
    driver: local
  
  # ì—ì´ì „íŠ¸ë³„ ì „ìš© ë³¼ë¥¨
  structura_models:
    driver: local
  cognita_cache:
    driver: local
  chronos_models:
    driver: local
  sentio_cache:
    driver: local
  agora_data:
    driver: local
  supervisor_logs:
    driver: local
  integration_results:
    driver: local

# =============================================================================
# ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •
# =============================================================================
networks:
  agentic-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

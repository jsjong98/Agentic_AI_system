services:
  # =============================================================================
  # ğŸ¤– Structura Agent - ì •í˜• ë°ì´í„° ML ë¶„ì„ (CPU ì „ìš©)
  # =============================================================================
  structura:
    build: 
      context: ./app/Structura
      dockerfile: Dockerfile
    container_name: agentic-structura-cpu
    restart: unless-stopped
    ports:
      - "5001:5001"
    volumes:
      - structura_models:/app/models
      - structura_cache:/app/cache
      - structura_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - STRUCTURA_PORT=5001
      - CUDA_VISIBLE_DEVICES=""
      - OMP_NUM_THREADS=2
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 1G
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸ§  Cognita Agent - ë„¤íŠ¸ì›Œí¬ ê´€ê³„ ë¶„ì„ (CPU ì „ìš©)
  # =============================================================================
  cognita:
    build: 
      context: ./app/Cognita
      dockerfile: Dockerfile
    container_name: agentic-cognita-cpu
    restart: unless-stopped
    ports:
      - "5002:5002"
    volumes:
      - cognita_cache:/app/cache
      - cognita_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - COGNITA_PORT=5002
      - NEO4J_URI=bolt://54.162.43.24:7687
      - NEO4J_USERNAME=neo4j
      - NEO4J_PASSWORD=resident-success-moss
      - OMP_NUM_THREADS=2
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5002/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # â° Chronos Agent - ì‹œê³„ì—´ ë”¥ëŸ¬ë‹ ë¶„ì„ (CPU ì „ìš©)
  # =============================================================================
  chronos:
    build: 
      context: ./app/Chronos
      dockerfile: Dockerfile
    container_name: agentic-chronos-cpu
    restart: unless-stopped
    ports:
      - "5003:5003"
    volumes:
      - chronos_models:/app/models
      - chronos_cache:/app/cache
      - chronos_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - CHRONOS_PORT=5003
      - CUDA_VISIBLE_DEVICES=""
      - OMP_NUM_THREADS=2
      - MKL_NUM_THREADS=2
    deploy:
      resources:
        limits:
          memory: 4G  # ë”¥ëŸ¬ë‹ ëª¨ë¸ì„ ìœ„í•œ ë” ë§ì€ ë©”ëª¨ë¦¬
          cpus: '2.0'
        reservations:
          memory: 2G
          cpus: '1.0'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5003/api/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸ’­ Sentio Agent - í…ìŠ¤íŠ¸ ê°ì • ë¶„ì„ (CPU ì „ìš©)
  # =============================================================================
  sentio:
    build: 
      context: ./app/Sentio
      dockerfile: Dockerfile
    container_name: agentic-sentio-cpu
    restart: unless-stopped
    ports:
      - "5004:5004"
    volumes:
      - sentio_cache:/app/cache
      - sentio_models:/app/models
      - sentio_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - SENTIO_PORT=5004
      - CUDA_VISIBLE_DEVICES=""
      - OMP_NUM_THREADS=2
      # - OPENAI_API_KEY=${OPENAI_API_KEY}  # .env íŒŒì¼ì—ì„œ ì£¼ì…
    deploy:
      resources:
        limits:
          memory: 3G  # Transformers ëª¨ë¸ì„ ìœ„í•œ ë©”ëª¨ë¦¬
          cpus: '1.5'
        reservations:
          memory: 1.5G
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5004/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸ›ï¸ Agora Agent - ì‹œì¥ ë¶„ì„ + LLM (CPU ì „ìš©)
  # =============================================================================
  agora:
    build: 
      context: ./app/Agora
      dockerfile: Dockerfile
    container_name: agentic-agora-cpu
    restart: unless-stopped
    ports:
      - "5005:5005"
    volumes:
      - agora_data:/app/data
      - agora_cache:/app/cache
      - agora_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - AGORA_PORT=5005
      - CHROME_BIN=/usr/bin/chromium-browser
      - CHROMEDRIVER_PATH=/usr/bin/chromedriver
      - OMP_NUM_THREADS=2
      # - OPENAI_API_KEY=${OPENAI_API_KEY}  # .env íŒŒì¼ì—ì„œ ì£¼ì…
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 1G
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5005/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸ‘‘ Supervisor Agent - LangGraph ì›Œí¬í”Œë¡œìš° ê´€ë¦¬ (CPU ì „ìš©)
  # =============================================================================
  supervisor:
    build: 
      context: ./app/Supervisor
      dockerfile: Dockerfile
    container_name: agentic-supervisor-cpu
    restart: unless-stopped
    ports:
      - "5006:5006"
    volumes:
      - supervisor_logs:/app/logs
      - supervisor_cache:/app/cache
      - supervisor_uploads:/app/uploads
    environment:
      - PYTHONUNBUFFERED=1
      - SUPERVISOR_PORT=5006
      - OMP_NUM_THREADS=2
      # ì›Œì»¤ ì—ì´ì „íŠ¸ URL (Docker ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ í†µì‹ )
      - STRUCTURA_URL=http://structura:5001
      - COGNITA_URL=http://cognita:5002
      - CHRONOS_URL=http://chronos:5003
      - SENTIO_URL=http://sentio:5004
      - AGORA_URL=http://agora:5005
      - INTEGRATION_URL=http://integration:5007
      # - OPENAI_API_KEY=${OPENAI_API_KEY}  # .env íŒŒì¼ì—ì„œ ì£¼ì…
    depends_on:
      structura:
        condition: service_healthy
      cognita:
        condition: service_healthy
      chronos:
        condition: service_healthy
      sentio:
        condition: service_healthy
      agora:
        condition: service_healthy
      integration:
        condition: service_healthy
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.5'
        reservations:
          memory: 1G
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5006/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸ”— Integration Agent - ê²°ê³¼ í†µí•© ë° ìµœì í™” (CPU ì „ìš©)
  # =============================================================================
  integration:
    build: 
      context: ./app/Integration
      dockerfile: Dockerfile
    container_name: agentic-integration-cpu
    restart: unless-stopped
    ports:
      - "5007:5007"
    volumes:
      - integration_results:/app/results
      - integration_cache:/app/cache
      - integration_logs:/app/logs
    environment:
      - PYTHONUNBUFFERED=1
      - INTEGRATION_PORT=5007
      - OMP_NUM_THREADS=2
      # - OPENAI_API_KEY=${OPENAI_API_KEY}  # .env íŒŒì¼ì—ì„œ ì£¼ì…
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 1G
          cpus: '0.5'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5007/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - agentic-network

  # =============================================================================
  # ğŸŒ React Dashboard - í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤
  # =============================================================================
  dashboard:
    build: 
      context: ./Dashboard
      dockerfile: Dockerfile
    container_name: agentic-dashboard-cpu
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      supervisor:
        condition: service_healthy
    environment:
      # React í™˜ê²½ ë³€ìˆ˜ (ë¹Œë“œ ì‹œì ì— ì„¤ì •ë¨)
      - REACT_APP_API_BASE_URL=http://localhost:5006
      - REACT_APP_SUPERVISOR_URL=http://localhost:5006
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.25'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - agentic-network

# =============================================================================
# ğŸ“¦ ë³¼ë¥¨ ì„¤ì • - ì—ì´ì „íŠ¸ë³„ ë°ì´í„° ì˜ì†ì„±
# =============================================================================
volumes:
  # Structura ë³¼ë¥¨
  structura_models:
    driver: local
  structura_cache:
    driver: local
  structura_logs:
    driver: local
  
  # Cognita ë³¼ë¥¨
  cognita_cache:
    driver: local
  cognita_logs:
    driver: local
  
  # Chronos ë³¼ë¥¨
  chronos_models:
    driver: local
  chronos_cache:
    driver: local
  chronos_logs:
    driver: local
  
  # Sentio ë³¼ë¥¨
  sentio_cache:
    driver: local
  sentio_models:
    driver: local
  sentio_logs:
    driver: local
  
  # Agora ë³¼ë¥¨
  agora_data:
    driver: local
  agora_cache:
    driver: local
  agora_logs:
    driver: local
  
  # Supervisor ë³¼ë¥¨
  supervisor_logs:
    driver: local
  supervisor_cache:
    driver: local
  supervisor_uploads:
    driver: local
  
  # Integration ë³¼ë¥¨
  integration_results:
    driver: local
  integration_cache:
    driver: local
  integration_logs:
    driver: local

# =============================================================================
# ğŸŒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •
# =============================================================================
networks:
  agentic-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
